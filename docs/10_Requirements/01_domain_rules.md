# 연차 도메인 분석 (보편 언어 정의)

이 문서는 DDD(Domain-Driven Design)를 적용하기 위한 첫 단계인 **도메인 분석**과 **보편 언어(Ubiquitous Language)** 정의를 위한 공간입니다.

---

## 1. 연차 생성 (Grant/Creation)
* **질문:** 연차는 언제, 어떤 기준으로 생성(부여)되나요?
* **답변:**
    1. **1년 미만 근무자 (선생성 후부여 방식):**
        - **일괄 생성:** 입사 시점에 1년 치(최대 11개)의 연차 데이터를 미리 생성(Pre-generation)한다.
        - **사용 시점 제한 (Lock-up):** 생성된 연차는 즉시 사용할 수 없으며, 각 연차의 **'사용 가능 시작일(Effective Date)'**이 도래해야 '사용 가능' 상태로 전환된다.
            - *예:* 1월 1일 입사자 -> 2번째 연차의 사용 가능일은 2월 1일.
        - **목적:** 매월 반복되는 배치 작업의 부하를 제거하고, 데이터 정합성 관리 비용을 줄인다.
        - **사후 조정:** 중도 퇴사나 결근 발생 시, 관리자(Admin) 기능을 통해 아직 사용 가능일이 도래하지 않은(혹은 이미 도래한) 연차를 회수/조정한다.
    2. **1년 이상 근무자 (회계연도 기준 부여):**
        - 매년 1월 1일에 전년도 근속 기간에 대한 연차를 일괄 부여한다.
        - 기본 연차는 15일이며, 근속 연수 3년 차부터는 매 2년마다 1일을 가산한다. (최대 25일 한도)
    3. **회계연도 편입 시 비례 계산:**
        - 1년 미만자가 처음으로 1월 1일을 맞이할 경우, `(전년도 재직일수 / 365) * 15일`로 비례 계산하여 부여한다.

* **질문:** 생성된 연차의 "유효기간"은 어떻게 결정되나요?
* **답변:**
    - **월 단위 연차:** 발생일로부터 1년간 유효하다.
    - **회계연도 연차:** 발생한 당해 12월 31일까지 유효하다.
    - 유효기간이 지난 연차는 '만료' 상태가 되어 사용할 수 없다.

---

## 2. 연차 사용 (Usage)
* **질문:** 연차를 사용할 때 필요한 조건은 무엇인가요?
* **답변:**
    - 보유하고 있는 '사용 가능한 연차(잔여 연차)' 범위 내에서만 신청할 수 있다. (마이너스 사용 불가)
    - 유효기간이 만료되지 않은 연차만 사용할 수 있다.

* **질문:** 사용 신청을 하면 바로 차감되나요, 아니면 승인 절차(결재) 후 차감되나요?
* **답변:**
    - 사용자가 '신청'을 하는 순간 해당 일수만큼 **차감 대기(Hold)** 상태가 되어 다른 사람이 중복으로 사용할 수 없게 잔액을 선점한다.
    - 관리자가 '승인'을 하면 최종적으로 **차감(Deducted)** 확정된다.
    - 만약 '반려'되거나 '취소'하면 선점했던 잔액은 다시 복구된다.

* **질문:** 연차 사용 단위는 어떻게 되나요?
* **답변:**
    - 1일(종일), 0.5일(반차), 0.25일(반반차) 단위로 사용할 수 있다.

---

## 3. 연차 정산 (Settlement)
* **질문:** 연차 정산(보상 혹은 소멸)은 언제 일어나나요?
* **답변:**
    1. **만료 시 정산:** 연차의 유효기간이 끝나는 시점(월 단위 연차는 1년 후, 회계연도 연차는 12월 31일)에 남은 연차를 정산한다.
    2. **퇴사 시 정산:** 직원이 퇴사하는 시점에 남은 모든 연차를 정산한다.

* **질문:** 미사용 연차는 어떻게 처리되나요?
* **답변:**
    - 원칙적으로 미사용 연차는 '연차 수당'으로 보상(지급)되어야 한다.
    - 정산이 완료된 연차는 잔여 연차에서 '0'으로 변경되고 '정산 완료' 상태가 된다.

---

## 4. 상세 규칙 및 엣지 케이스 (보강 필요)

* **Q1. 소수점 처리 방식 (Rounding Rule)**
    * **상황:** 회계연도 편입 시 비례 계산 `(전년도 재직일수 / 365) * 15` 결과가 12.3일이 나왔을 때, 몇 일로 부여합니까?
    * **답변:**
        * 소수점 첫째 자리에서 올림

* **Q2. 입사일 기준 엣지 케이스**
    * **상황:** 12월 31일 입사자는 다음 날(1월 1일)에 연차 부여 대상인가요? (재직일수 1일 -> 계산 시 0.04일)
    * **답변:**
        * 0.04일 올림하여 1일로 생성

* **Q3. 윤년(Leap Year) 계산**
    * **상황:** 윤년(366일)이 낀 해의 재직일수 계산 시 분모를 365로 고정하나요, 아니면 366으로 하나요?
    * **답변:**
        * 통상적으로 365일 고정

* **Q4. 연차 촉진 프로세스 범위**
    * **상황:** '연차 촉진' 기능을 구현할 때, 시스템이 어디까지 책임져야 하나요?
    * **답변:**
        * 단순화 모델 적용: 본 프로젝트는 복잡한 행정 절차(통보 시기 계산, 서면 청구 등) 구현보다는 핵심 도메인 로직의 설계와 성능에 집중하기 위해, 촉진 프로세스를 상태 기반으로 추상화한다.
        * 구현 범위:
            1. 연차 부여(LeaveGrant) 건별로 촉진 완료(Promoted) 상태를 마킹할 수 있다.
            2. 이 상태 값은 외부(인사팀/ 타 시스템)에서 적법한 절차를 거쳤다고 가정하고 API를 통해 변경된다.
            3. 정산 로직의 핵심: 정산 시점에는 오직 이 상태값(isPromoted)만을 참조하여 금전 보상 여부(유급/무급)를 결정하는 유연한 정책 구조(Strategy Pattern 등)을 구현하는데 집중한다.
